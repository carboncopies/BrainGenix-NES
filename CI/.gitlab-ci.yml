# Improved caching configuration
cache:
  # Create cache keys based on branch and files that affect dependencies
  key: 
    files:
      - vcpkg.json
      - vcpkg-configuration.json
      - CMakeLists.txt
    prefix: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"
  paths:
    # Build artifacts
    - Build/
    # Compiler cache for faster C++ compilation
    - .ccache/
    # vcpkg cache for faster dependency installation
    - vcpkg_installed/
    - ThirdParty/vcpkg/downloads/
    - ThirdParty/vcpkg/buildtrees/
    # CMake cache
    - CMakeCache.txt
    - CMakeFiles/
  policy: pull-push

# Set some global variables
variables:
  PROJECT_NAME: "BrainGenix-NES"
  PLATFORM_BUILD_PREAMBLE: "$PROJECT_NAME_$CI_COMMIT_SHORT_SHA"
  GIT_SUBMODULE_STRATEGY: recursive

# List of stages for jobs, and their order of execution
stages:
  - Update CI Containers
  - Build
  - Package
  - Deploy
  - Test # Temp. disabled tests as they have not yet been implemented.

# Focusing on Ubuntu2204 for now

include: 
  # Update CI Containers
  - '/CI/Images/Ubuntu2404/CI.yml'
  - '/CI/Images/Doxygen/CI.yml'
  # - '/CI/Images/Drawio/CI.yml' Disabled for now since this uses Electron which is a pain in the ass.

  # Executable Builders
  - '/CI/Build/Ubuntu2404/CI.yml'
  - '/CI/Docs/Doxygen/CI.yml'
  # - '/CI/Docs/Drawio/CI.yml' Disabled for now since this uses Electron which is a pain in the ass.

  # Tests
  - '/CI/Test/Ubuntu2404/CI.yml'

  # Package Stage
  - '/CI/Package/Ubuntu2404/CI.yml'


  # TODO: Packaging Tets here

  # TODO: Staging here

  # TODO: Staging Tests here



  # Deploy To Prod
  # - '/CI/Deploy/Prod.yml'
